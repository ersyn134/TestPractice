{% extends 'base.html' %}
{% block title %}Вопрос {{ current_index }}{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="alert alert-info text-center mb-3" id="timer-container">
        Осталось времени: <span id="timer">--:--</span>
    </div>

  <!-- Прогресс-бар -->
  <div class="progress mb-3" style="height: 25px;">
    <div class="progress-bar" role="progressbar" style="width: {{ progress_percent }}%;" aria-valuenow="{{ progress_percent }}" aria-valuemin="0" aria-valuemax="100">
      {{ current_index }} / {{ total_questions }}
    </div>
  </div>

  <h4>Вопрос {{ current_index }} из {{ total_questions }}</h4>
  <p class="mt-3">{{ question.text }}</p>

  <form method="post" id="question-form">
    {% csrf_token %}

    <div class="form-check mb-2">
      <input class="form-check-input" type="radio" name="selected_option" id="optionA" value="A" required>
      <label class="form-check-label" for="optionA">
        A. {{ question.option_a }}
      </label>
    </div>

    <div class="form-check mb-2">
      <input class="form-check-input" type="radio" name="selected_option" id="optionB" value="B">
      <label class="form-check-label" for="optionB">
        B. {{ question.option_b }}
      </label>
    </div>

    <div class="form-check mb-2">
      <input class="form-check-input" type="radio" name="selected_option" id="optionC" value="C">
      <label class="form-check-label" for="optionC">
        C. {{ question.option_c }}
      </label>
    </div>

    <div class="form-check mb-4">
      <input class="form-check-input" type="radio" name="selected_option" id="optionD" value="D">
      <label class="form-check-label" for="optionD">
        D. {{ question.option_d }}
      </label>
    </div>

    <button type="submit" class="btn btn-primary">
      {% if is_last %}Завершить{% else %}Следующий{% endif %}
    </button>
  </form>
<script>
  let timeLeft = {{ time_left|default:0 }};
  const timerDisplay = document.getElementById("timer");

  function formatTime(seconds) {
    const mins = Math.floor(seconds / 60);
    const secs = seconds % 60;
    return `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
  }

  function updateTimer() {
    if (timeLeft <= 0) {
      clearInterval(timerInterval);

    const form = document.getElementById("question-form");
    const selected = document.querySelector('input[name="selected_option"]:checked');

      // Если пользователь ничего не выбрал — добавляем hidden input
      if (!selected) {
        const hidden = document.createElement('input');
        hidden.type = 'hidden';
        hidden.name = 'selected_option';
        hidden.value = '';  // Пустой выбор — будет считаться как неправильный
        form.appendChild(hidden);
      }

      form.submit();
    } else {
      timerDisplay.textContent = formatTime(timeLeft);
      if (timeLeft <= 60) {
        timerDisplay.classList.add("text-danger", "fw-bold");
      }
      timeLeft--;
    }
  }

  updateTimer();
  const timerInterval = setInterval(updateTimer, 1000);
</script>


</div>
{% endblock %}
